var e=Object.defineProperty;import{r as t}from"./phaser-UvlxNa5i.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var s=t();const a=300;class i extends s.Scene{constructor(){var t,s;super("TimkaRun"),((t,s,a)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a})(this,"symbol"!=typeof(t="gameState")?t+"":t,s)}preload(){this.load.image("background-tile","assets/Background/Purple.png"),this.load.spritesheet("terrain-tiles","assets/Terrain/Terrain (16x16).png",{frameWidth:16,frameHeight:16,spacing:0}),this.load.image("box","assets/Items/Boxes/StaticBox (20x20).png"),this.load.spritesheet("player-idle","assets/Main Characters/Ninja Frog/Idle (32x32).png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("player-run","assets/Main Characters/Ninja Frog/Run (32x32).png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("player-jump","assets/Main Characters/Ninja Frog/Jump (32x32).png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-apple","assets/Items/Fruits/Apple.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-banana","assets/Items/Fruits/Bananas.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-cherry","assets/Items/Fruits/Cherries.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-kiwi","assets/Items/Fruits/Kiwi.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-melon","assets/Items/Fruits/Melon.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-orange","assets/Items/Fruits/Orange.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-pineapple","assets/Items/Fruits/Pineapple.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-strawberry","assets/Items/Fruits/Strawberry.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.spritesheet("fruit-collected","assets/Items/Fruits/Collected.png",{frameWidth:32,frameHeight:32,spacing:0}),this.load.image("star","assets/Items/Star.png"),this.load.image("ngolo","assets/Traps/ngolo.png"),this.load.spritesheet("finish","assets/Items/Checkpoints/Checkpoint/Checkpoint (Flag Idle)(64x64).png",{frameWidth:64,frameHeight:64,spacing:0}),this.load.spritesheet("confetti","assets/Other/Confetti (16x16).png",{frameWidth:16,frameHeight:16,spacing:0}),this.load.image("up","assets/Controls/up.png"),this.load.image("left","assets/Controls/left.png"),this.load.image("right","assets/Controls/right.png"),this.load.audio("jump1","assets/Sounds/jump.mp3"),this.load.audio("fall","assets/Sounds/fall.mp3"),this.load.audio("hit","assets/Sounds/hit.mp3"),this.load.audio("fruit","assets/Sounds/fruit.mp3"),this.load.audio("win","assets/Sounds/win.mp3"),this.load.audio("boom","assets/Sounds/boom.mp3"),this.load.audio("music","assets/Sounds/music.mp3")}createAnimations(){this.anims.create({key:"idle",frames:this.anims.generateFrameNumbers("player-idle",{start:0,end:10}),frameRate:18,repeat:-1}),this.anims.create({key:"run",frames:this.anims.generateFrameNumbers("player-run",{start:0,end:11}),frameRate:18,repeat:-1}),this.anims.create({key:"jump",frames:this.anims.generateFrameNumbers("player-jump",{start:0,end:0}),frameRate:0,repeat:0}),this.anims.create({key:"fruit-collected",frames:this.anims.generateFrameNumbers("fruit-collected",{start:0,end:5}),frameRate:22,repeat:0}),this.anims.create({key:"finish",frames:this.anims.generateFrameNumbers("finish",{start:0,end:9}),frameRate:22,repeat:-1})}endGame(){if(this.gameState.gameEnded)return;this.gameState.gameEnded=!0,this.sound.stopByKey("music"),this.sound.play("win"),this.cameras.main.stopFollow();const e=this.cameras.main.worldView.x+this.cameras.main.width/2,t=this.cameras.main.worldView.y+this.cameras.main.height/2,s=this.add.particles(e,t,"confetti",{frame:[0,1,2,3,4,5],lifespan:4e3,speed:{min:50,max:200},scale:{start:.15,end:0},gravityY:200,blendMode:"NORMAL",emitting:!1}),a=this.cameras.main.width/2,i=this.cameras.main.height/2;this.time.addEvent({startAt:0,delay:500,repeat:-1,callback:()=>{this.sound.play("boom"),s.explode(50,(2*Math.random()-1)*a,(2*Math.random()-1)*i)}}),this.add.text(this.scale.width-10,10,"Перезапустить",{fontFamily:"monospace",fontSize:"24px",color:"#ffffff",backgroundColor:"#000000"}).setOrigin(1,0).setPadding(10).setScrollFactor(0).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.scene.restart()}))}create(){var e,t;this.createAnimations();this.physics.world.gravity.y=800;const s=this.add.tileSprite(0,0,3040,this.scale.height,"background-tile");s.setOrigin(0,0),s.setVisible(true),this.physics.world.setBounds(0,0,3040,this.scale.height),this.physics.world.setBoundsCollision(!0,!0,!1,!1);let i=NaN;isNaN(i)&&(i=32);const o=this.physics.add.sprite(i,-30,"player-idle");o.body.setSize(22,27,!1),o.body.setOffset(5,4),o.setCollideWorldBounds(!0),o.setBounce(0),o.setDragX(2e3),o.setVisible(true),o.play("idle");const{keyboard:n}=this.input;if(!n)throw new Error("Keyboard input not available");const l=n.createCursorKeys(),d=null==(e=this.input.gamepad)?void 0:e.getPad(0);null==(t=this.input.gamepad)||t.on("connected",(e=>{console.log("Gamepad connected:",e.id),this.gameState.gamepad=e})),this.cameras.main.setBounds(-100,0,3240,this.scale.height),this.cameras.main.startFollow(o,!0,1,1,-50,0),this.cameras.main.setDeadzone(100,this.scale.height);{const e=".                                                                            0                       0                                               x\n .                                                                            0                       0                                 c            xxx\n .                                                                           x0                       0                             c  00s          xxxxx\n .                                                                           x0  xxxxxxxxxxxxxxx0     0                         c  00    s         0000000\n .                                                                           x0  xxxxxxxxxxxxxxx0    00n                    c  00        s\n .                                                         m  b  m  x         0  xxxxxxxxnxxxxxx0     00       m        c  00            s         k k k k\n ......         ..............a......  x         oooooo    0  0  0  0         0  00000000000000000    0             c  00                s       00000000000\n ......         .............aaa......xxx.......00000000                                              0            00                    s     \n ......         .....................00000........                                                    0       000                        s       o o o o o o          \n ....a.         .......00...........                                                     ppp         000      aaa                        s     000000000000000\n ......         .....0000................................................................   .......... .......aaa...................     x        \n ......    n    ...000000..........000..nn..00......................n.........n....................... .......aaa......n......n..........x........    n              x x x x x x \n 000000000000000000000000   0000000000000000000000000000000000000   000000000000000000000   000000000000000000000000   0000000000000000000000000000000000000000000 0n0n0n0n0n0n0n0 000000000000".split("\n").map((e=>e.trim().split("").map((e=>{switch(e){case"0":case"*":return 122;case"a":return 2001;case"b":return 2002;case"c":return 2003;case"k":return 2004;case"m":return 2005;case"o":return 2006;case"p":return 2007;case"s":return 2008;case"x":return 2009;case"n":return 3001;default:return-1}})))),t=Math.max(...e.map((e=>e.length)));e.forEach((e=>{for(;e.length<t;)e.push(-1)}));const s=this.make.tilemap({data:e,tileWidth:16,tileHeight:16}),i=s.addTilesetImage("terrain-tiles",void 0,16,16,0,0);if(!i)throw new Error("Tileset not found");const n=s.createLayer(0,i,0,0);if(!n)throw new Error("Layer not created");n.setCollisionBetween(0,1e3),this.physics.add.collider(o,n);{const e=[...r(s.createFromTiles([2001],void 0,{key:"fruit-apple",frame:0})),...r(s.createFromTiles([2002],void 0,{key:"fruit-banana",frame:0})),...r(s.createFromTiles([2003],void 0,{key:"fruit-cherry",frame:0})),...r(s.createFromTiles([2004],void 0,{key:"fruit-kiwi",frame:0})),...r(s.createFromTiles([2005],void 0,{key:"fruit-melon",frame:0})),...r(s.createFromTiles([2006],void 0,{key:"fruit-orange",frame:0})),...r(s.createFromTiles([2007],void 0,{key:"fruit-pineapple",frame:0})),...r(s.createFromTiles([2008],void 0,{key:"fruit-strawberry",frame:0})),...r(s.createFromTiles([2009],void 0,{key:"star",frame:0}))],t=this.physics.add.staticGroup(e);for(const s of t.getChildren()){const{body:e}=s;e.setSize(16,16,!1),e.setOffset(8,8)}this.physics.add.overlap(o,t,((e,t)=>{const s=t,a=this.add.sprite(s.x,s.y,"fruit-collected");a.play("fruit-collected").once("animationcomplete",(function(){a.destroy()})),t.destroy(),this.gameState.score+=1,this.gameState.scoreText.setText(`Очки: ${this.gameState.score}`),this.sound.play("fruit")}))}{const e=r(s.createFromTiles([3001],void 0,{key:"ngolo",frame:0})),t=this.physics.add.staticGroup(e);for(const s of t.getChildren()){const e=s;e.y-=1;const t=r(e.body);t.setSize(16,16,!1),t.setOffset(4,3)}this.physics.add.overlap(o,t,((e,t)=>{const s=e,i=t,n=r(s.body),l=r(i.body),d=n.x+n.width/2-(l.x+l.width/2);this.gameState.playerControlLockedUntil=this.time.now+200,s.setVelocity(Math.sign(d)*a,-100),this.cameras.main.shake(200,.005),o.tint=16711680,this.sound.play("hit")}))}}{const e=this.physics.add.sprite(2990,this.scale.height-48,"finish");e.body.setSize(24,44,!1),e.body.setOffset(16,20),e.body.setAllowGravity(!1),e.setImmovable(!0),e.play("finish");const t=this.physics.add.overlap(o,e,(()=>{this.physics.world.removeCollider(t),this.endGame()}))}const h=this.add.text(10,10,"Очки: 0",{fontFamily:"monospace",fontSize:"20px",color:"#ffffff"});h.setScrollFactor(0),h.setVisible(true),this.children.bringToTop(o),this.sound.play("music",{loop:!0,volume:.35});const c={left:!1,right:!1,up:!1};if(!this.sys.game.device.os.desktop){const e=this.add.image(30,this.scale.height-30,"left").setScrollFactor(0).setAlpha(.35).setScale(2).setInteractive({useHandCursor:!0}),t=this.add.image(100,this.scale.height-30,"right").setScrollFactor(0).setAlpha(.35).setScale(2).setInteractive({useHandCursor:!0}),s=this.add.image(this.scale.width-30,this.scale.height-30,"up").setScrollFactor(0).setAlpha(.35).setScale(2).setInteractive({useHandCursor:!0});e.on("pointerdown",(()=>{e.setAlpha(1),c.left=!0})),e.on("pointerup",(()=>{e.setAlpha(.35),c.left=!1})),t.on("pointerdown",(()=>{t.setAlpha(1),c.right=!0})),t.on("pointerup",(()=>{t.setAlpha(.35),c.right=!1})),s.on("pointerdown",(()=>{s.setAlpha(1),c.up=!0})),s.on("pointerup",(()=>{s.setAlpha(.35),c.up=!1}))}this.gameState={onScreenControls:c,background:s,playerControlLockedUntil:0,player:o,cursorKeys:l,gameEnded:!1,scoreText:h,score:0,gamepad:d}}update(e,t){var s,a,i,r,o,n,l,d,h,c,m,p;const{cursorKeys:u,player:f,playerControlLockedUntil:g,gameEnded:y,onScreenControls:x}=this.gameState;if(u){const b=200,v=(null==(i=null==(a=null==(s=this.gameState.gamepad)?void 0:s.axes)?void 0:a[0])?void 0:i.getValue())||0,w=x.left||(null==(r=u.left)?void 0:r.isDown)||((null==(o=this.gameState.gamepad)?void 0:o.left)??!1)||v<-.2,S=x.right||(null==(n=u.right)?void 0:n.isDown)||((null==(l=this.gameState.gamepad)?void 0:l.right)??!1)||v>.2,k=x.up||(null==(d=u.up)?void 0:d.isDown)||((null==(h=this.gameState.gamepad)?void 0:h.A)??!1)||((null==(c=this.gameState.gamepad)?void 0:c.B)??!1)||((null==(m=this.gameState.gamepad)?void 0:m.Y)??!1)||((null==(p=this.gameState.gamepad)?void 0:p.X)??!1);!y&&g<e&&(f.clearTint(),w?(f.setVelocityX(Math.max(-200,f.body.velocity.x-b*t)),f.setFlipX(!0)):S&&(f.setVelocityX(Math.min(b,f.body.velocity.x+b*t)),f.setFlipX(!1)),k&&f.body.blocked.down&&(f.setVelocityY(-300),this.sound.play("jump1"))),y&&f.body.blocked.down&&(f.setVelocityY(-300),f.setFlipX(!f.flipX)),this.gameState.player.body.blocked.down?0!==f.body.velocity.x&&f.body.blocked.down?f.play("run",!0):f.body.blocked.down&&f.play("idle",!0):f.play("jump",!0)}localStorage.setItem("last-player-x",f.x.toString()),f.y>this.scale.height+20&&(f.body.setAllowGravity(!1),f.setVelocity(0,0),f.y=-30,this.sound.play("fall"),this.cameras.main.flash(250),this.cameras.main.shake(500,.02),this.time.delayedCall(500,(()=>{f.body.setAllowGravity(!0)})))}}function r(e){if(null==e)throw new Error("Value is null or undefined");return e}class o extends Phaser.Scene{create(){const e=this.add.text(this.scale.width/2,this.scale.height/2,"Старт!",{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",align:"center",fixedWidth:260,backgroundColor:"#2d2d2d"}).setPadding(32).setOrigin(.5);e.setInteractive({useHandCursor:!0}),e.on("pointerover",(()=>{e.setBackgroundColor("#8d8d8d")})),e.on("pointerout",(()=>{e.setBackgroundColor("#2d2d2d")})),e.on("pointerup",(()=>{this.sys.game.device.os.desktop||this.scale.startFullscreen(),this.scene.start("Preload")}))}}class n extends Phaser.Scene{constructor(){super({key:"Preload"})}create(){this.add.text(this.scale.width/2,this.scale.height/2,"Загрузка...",{fontFamily:"Arial",fontSize:"16px",color:"#ffffff",align:"center",fixedWidth:260}).setPadding(32).setOrigin(.5),this.scene.launch("TimkaRun")}}const{clientWidth:l,clientHeight:d}=document.documentElement,h={type:s.AUTO,width:Math.max(208,208*l/d),height:208,parent:"game-container",scale:{zoom:2,mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,resizeInterval:100},backgroundColor:"#211f30",input:{keyboard:!0,gamepad:!0},physics:{default:"arcade",arcade:{fixedStep:!0,fps:100,debug:!1}},scene:[o,n,i]};document.addEventListener("DOMContentLoaded",(()=>{new s.Game({...h,parent:"game-container"})}));
